@using Entidades.Modelos
@model IEnumerable<Entidades.Modelos.MatriculaTurma>

@section Stylesheets {
    <link rel="stylesheet" href="./css/index_turmas.css" type="text/css" />
}

@{
   ViewData["Title"] = "Grade de Horários";
}

@{
    List<string> bootStrapColors = new List<string>();
    bootStrapColors.Add("bg-sky");
    bootStrapColors.Add("bg-green");
    bootStrapColors.Add("bg-pink");
    bootStrapColors.Add("bg-yellow");
    bootStrapColors.Add("bg-orange");
    bootStrapColors.Add("bg-purple");
    bootStrapColors.Add("bg-lightred");
    bootStrapColors.Add("bg-warning");
    bootStrapColors.Add("bg-dark");
    bootStrapColors.Add("bg-info");
    bootStrapColors.Add("bg-primary");

    IDictionary<Disciplina, string> discColorMap = new Dictionary<Disciplina, string>();
    Model.ToList().ForEach(mt =>
    {
        if (!discColorMap.ContainsKey(mt.Turma.Disciplina))
        {
            discColorMap.Add(mt.Turma.Disciplina, bootStrapColors[discColorMap.Count % bootStrapColors.Count]);
        }
    });

    List<HorarioGrade> horarios = Model.SelectMany(mt => mt.Turma.Horarios).Distinct().ToList();
    List<string> periodos = horarios.Select(h => h.Periodo()).Distinct().OrderBy(s => s.Substring(1)).ToList();
}

<h1>@ViewData["Title"]</h1>



<div class="container">
    <div class="timetable-img text-center">
        <img src="img/content/timetable.png" alt="">
    </div>
    <h5 class="alert-success">@(ViewBag.MatriculaSuccessMessage == null ? "" : @ViewBag.MatriculaSuccessMessage)</h5>
    <div class="table-responsive">
        <table class="table table-bordered text-center table-hover">
            <thead>
                <tr class="bg-light-gray">
                    <th class="text-uppercase">
                        Horário
                    </th>
                    <th class="text-uppercase">SEG</th>
                    <th class="text-uppercase">TER</th>
                    <th class="text-uppercase">QUA</th>
                    <th class="text-uppercase">QUI</th>
                    <th class="text-uppercase">SEX</th>
                </tr>
            </thead>
            <tbody>
                @foreach (string periodo in periodos)
                {
                    var horario = horarios.Find(h => h.Periodo().Equals(periodo));
                    <tr>
                        <td class="align-middle">
                            <p class="bg-light-gray rounded">@horario.Horario.Substring(1)</p>
                            <span>@horario.HorarioInicial</span><br />
                            <span>@horario.HorarioFinal</span>
                        </td>
                        @for (int i = 2; i <= 6; i++)
                        {
                            @if (Model.Any(mt => mt.Turma.Horarios.Any(hg => hg.Horario.Equals($"{i}{horario.Periodo()}"))))
                            {
                                var turma = Model.FirstOrDefault(mt => mt.Turma.Horarios.Any(hg => hg.Horario.Equals($"{i}{horario.Periodo()}")));
                                <td style="width: 18%">
                                    <div class="@discColorMap.Where(dcm => dcm.Key.Equals(@turma.Turma.Disciplina)).First().Value padding-5px-tb padding-15px-lr border-radius-5 margin-10px-bottom text-white font-size16 xs-font-size13">
                                        <span>@turma.Turma.Disciplina.Nome</span>
                                    </div>
                                    <div class="font-size13 text-light-gray margin-10px-top">@turma.Turma.Disciplina.Codigo</div>
                                    <div class="font-size13 text-light-gray">T.@turma.Turma.Id</div>
                                </td>
                            }
                            else
                            {
                                <td class="bg-light-gray" style="width: 18%"></td>
                            }
                        } 
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>