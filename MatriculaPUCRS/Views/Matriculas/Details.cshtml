@model IEnumerable<Entidades.Modelos.Turma>

@{
    ViewData["Title"] = "Matrícula";
}

<div class="container">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/Matriculas">Matrículas</a></li>
            <li class="breadcrumb-item"><a href="/Matriculas/Disciplinas">Disciplinas</a></li>
            <li class="breadcrumb-item active" aria-current="page">@ViewBag.Disciplina.Nome</li>
        </ol>
    </nav>

    <h2>@ViewBag.Disciplina.NomeParaLista</h2>
    <h5 class="text-muted">Turmas Disponíveis - @ViewBag.Semestre.Titulo</h5>

    @if (ViewBag.ErrorMessage is not null)
    {
        <div id="errorToast" class="toast ml-auto show" role="alert" aria-live="assertive" aria-atomic="true" data-delay="700" style="color:white;">
            <div class="toast-header justify-content-between" style="background-color:#ff8080; color:white;">
                <img src="~/images/pucrsicon.png" width="20px" height="20px" class="rounded me-2" alt="pucrs">
                <strong class="me-auto ml-1">Falha ao realizar matrícula</strong>
                <button type="button" class="close float-right justify-content-end" data-dismiss="toast" aria-label="Close" onclick="closeError()">
                    ×
                </button>
            </div>
            <div class="toast-body" style="color:black">
                @ViewBag.ErrorMessage
            </div>
        </div>

    }

    <table class="table">
        <thead>
            <tr>
                <th>
                    <a asp-action="Details" asp-route-sortOrder="@ViewData["IdSortParm"]">@Html.DisplayNameFor(model => model.Id)</a>
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.NumeroDeVagas)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.VagasRemanescentes)
                </th>
                <th>
                    <a asp-action="Details" asp-route-sortOrder="@ViewData["HorarioSortParm"]">@Html.DisplayNameFor(model => model.Horarios)</a>
                </th>
                <th align="right"></th>
            </tr>
        </thead>
        <tbody>
        @foreach (var item in Model)
        {
            <form asp-controller="Matriculas" asp-action="Matricular" method="post" role="form">
                <tr>
                    <td>
                        <input type="hidden" name="turmaId" value="@item.Id" />
                        <input type="hidden" name="disciplinaId" value="@item.DisciplinaId" />
                        <input type="hidden" name="semestreId" value="@item.SemestreId" />
                        @Html.DisplayFor(modelItem => item.Id)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.NumeroDeVagas)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.VagasRemanescentes)
                    </td>
                    <td>
                        <p>
                        @foreach (var horario in item.Horarios.OrderBy(h => h.Horario))
                        {
                            @Html.DisplayFor(modelItem => horario.Horario)
                        }
                        </p>
                    </td>
                    <td  align="right">
                        <div>
                            <button type="submit" class="btn btn-outline-success">Matricular</button>
                        </div>
                    </td>
                </tr>
                
            </form>
        }
        </tbody>
    </table>


    <style>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }

        #errorToast {
            position: absolute;
            right: 0%;
            bottom: 6.5%;
        }

        #btnCloseError {
            padding: 0;
            border: none;
            background: none;
        }
    </style>

    <script>
        function closeError() {
            document.getElementById('errorToast').style.display = "none";
        }
    </script>
</div>